<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>From Hexagons to Foresight – Maps That Matter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="How H3 hexagons, a spatial datacube, and visualisations turn Dutch geo-data into insight, time travel, and foresight."
  />

  <!-- Privacy-friendly analytics by Plausible -->
  <script async src="https://plausible.io/js/pa-unGG15m6r6ufvAQNAPz3f.js"></script>
  <script>
    window.plausible = window.plausible || function () {
      (plausible.q = plausible.q || []).push(arguments);
    };
    plausible.init = plausible.init || function (i) { plausible.o = i || {}; };
    plausible.init();
  </script>

  <style>
    :root {
      --bg: #ffffff;
      --text: #222222;
      --accent: #004b6b;
      --muted: #666666;
      --border: #dddddd;
      --max-width: 760px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.7;
      background: var(--bg);
      color: var(--text);
    }

    /* Reading Progress Bar */
    .progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 0%;
      height: 3px;
      background: var(--accent);
      z-index: 1000;
      transition: width 0.1s ease;
    }

    .container {
      display: flex;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
    }

    /* Social Sharing Sidebar */
    .social-share {
      flex: 0 0 60px;
      padding: 2.5rem 0 4rem 1.25rem;
    }

    .social-share-sticky {
      position: sticky;
      top: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .share-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      color: var(--muted);
    }

    .share-button:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .share-button svg { width: 18px; height: 18px; }

    /* Table of Contents */
    .toc-wrapper {
      flex: 0 0 240px;
      padding: 2.5rem 1rem 4rem 1.25rem;
    }

    .toc { position: sticky; top: 2rem; }

    .toc-title {
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
      margin: 0 0 1rem;
    }

    .toc-list { list-style: none; margin: 0; padding: 0; }

    .toc-list li { margin-bottom: 0.5rem; }

    .toc-list a {
      display: block;
      color: var(--muted);
      text-decoration: none;
      font-size: 0.9rem;
      padding: 0.25rem 0;
      border-left: 2px solid transparent;
      padding-left: 0.75rem;
      transition: all 0.2s ease;
    }

    .toc-list a:hover {
      color: var(--accent);
      border-left-color: var(--accent);
    }

    .toc-list a.active {
      color: var(--accent);
      border-left-color: var(--accent);
      font-weight: 500;
    }

    /* Main Content */
    .page {
      flex: 1;
      max-width: var(--max-width);
      padding: 2.5rem 1.25rem 4rem;
    }

    header { margin-bottom: 2rem; }

    h1 {
      font-size: clamp(2rem, 3vw, 2.6rem);
      margin: 0 0 0.5rem;
      color: var(--accent);
      line-height: 1.2;
    }

    /* Meta information */
    .post-meta {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
      font-size: 0.9rem;
      color: var(--muted);
      flex-wrap: wrap;
    }

    .author-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .author-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--border);
    }

    .meta-item { display: flex; align-items: center; gap: 0.5rem; }

    .meta-divider { color: var(--border); }

    h2 {
      margin-top: 2.5rem;
      margin-bottom: 0.75rem;
      font-size: 1.4rem;
      line-height: 1.4;
      color: var(--accent);
      scroll-margin-top: 2rem;
    }

    h3 {
      margin-top: 2rem;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }

    p { margin: 0 0 1rem; color: var(--text); }

    p.lead { font-size: 1.05rem; color: var(--muted); }

    a {
      color: var(--accent);
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 0.15em;
    }

    a:hover { opacity: 0.85; }

    /* Section breaks */
    section { position: relative; }

    section:not(:last-child) {
      margin-bottom: 3rem;
      padding-bottom: 3rem;
      border-bottom: 1px solid #f0f0f0;
    }

    /* Media containers */
    .iframe-wrapper,
    .video-wrapper,
    .image-wrapper {
      margin: 1.5rem auto 2rem;
      max-width: 900px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    iframe,
    video,
    .image-wrapper img {
      display: block;
      width: 100%;
      border: 0;
    }

    .note {
      font-size: 0.9rem;
      color: var(--muted);
      margin-top: 0.5rem;
    }

    ul, ol { margin: 0 0 1rem 1.2rem; padding: 0; }

    li { margin-bottom: 0.25rem; }

    /* Mobile Social Share */
    .mobile-share {
      display: none;
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 2px solid var(--border);
    }

    .mobile-share-title {
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
      margin: 0 0 1rem;
    }

    .mobile-share-buttons { display: flex; gap: 1rem; }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .social-share { display: none; }
      .toc-wrapper { display: none; }
      .container { display: block; }
      .page { max-width: 100%; margin: 0 auto; }
      .mobile-share { display: block; }
    }

    @media (min-width: 900px) {
      .page { padding-top: 3rem; }
    }

    html { scroll-behavior: smooth; }
  </style>
</head>

<body>
  <!-- Reading Progress Bar -->
  <div class="progress-bar" id="progressBar"></div>

  <div class="container">
    <!-- Social Sharing Sidebar -->
    <aside class="social-share">
      <div class="social-share-sticky">
        <a href="#" class="share-button" id="shareTwitter" title="Share on X" aria-label="Share on X">
          <svg fill="currentColor" viewBox="0 0 24 24">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
          </svg>
        </a>
        <a href="#" class="share-button" id="shareLinkedIn" title="Share on LinkedIn" aria-label="Share on LinkedIn">
          <svg fill="currentColor" viewBox="0 0 24 24">
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
          </svg>
        </a>
        <a href="#" class="share-button" id="shareEmail" title="Share via email" aria-label="Share via email">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
        </a>
        <a href="#" class="share-button" id="copyLink" title="Copy link" aria-label="Copy link">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
          </svg>
        </a>
      </div>
    </aside>

    <!-- Table of Contents -->
    <aside class="toc-wrapper">
      <nav class="toc">
        <div class="toc-title">Contents</div>
        <ul class="toc-list">
          <li><a href="#honeycomb">The honeycomb that makes data talk</a></li>
          <li><a href="#one-map">Step 1 – One map, one story</a></li>
          <li><a href="#time-travel">Step 2 – When one layer isn't enough</a></li>
          <li><a href="#talking">Step 3 – Talking to your data</a></li>
          <li><a href="#predictions">Step 4 – From patterns to predictions</a></li>
          <li><a href="#explore">Step 5 – Play, explore, decide</a></li>
          <li><a href="#looking-ahead">Step 6 – Looking ahead</a></li>
          <li><a href="#final">Final thought</a></li>
          <li><a href="#try">Try it yourself</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="page">
      <header>
        <h1>From Hexagons to Foresight</h1>
        <p class="lead">
          Not everything can fit everywhere, all the time, all at once. Cats, however, keep trying.
        </p>

        <div class="post-meta">
          <div class="author-info">
            <img src="images/profile_pic_thijs_hexagons.png" alt="Thijs Oosterhuis" class="author-avatar" />
            <span>Thijs Oosterhuis</span>
          </div>
          <span class="meta-divider">•</span>
          <div class="meta-item">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>December 9, 2025</span>
          </div>
          <span class="meta-divider">•</span>
          <div class="meta-item">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span id="readTime">12 min read</span>
          </div>
        </div>
      </header>

      <section>
        <p>
          If you read my previous post, <em>From Chaos to Clarity</em>, you’ll remember the goal: turn a pile of CSVs,
          shapefiles, and spreadsheets into one coherent thing — a spatial datacube you can actually work with.
        </p>

        <p>
          Once the data is clean and connected, the next question is the fun one:
          <strong>what do you see when everything finally speaks the same spatial language?</strong>
        </p>

        <p>That’s where H3 comes in.</p>
      </section>

      <section>
        <h2 id="honeycomb">The honeycomb that makes data talk</h2>

        <p>
          H3 slices the world into a honeycomb of hexagons. Each cell covers a similar area, so whether you’re mapping
          housing prices, noise, flood risk, or biodiversity, everything lines up on the same grid.
        </p>

        <p>
          Think of it as Lego for geography. Once the pieces fit, you can build meaning — not just pretty layers.
        </p>
      </section>

      <section>
        <h2 id="one-map">Step 1 – One map, one story</h2>

        <p>Let’s start with one indicator.</p>

        <p>
          Take <strong>groundheight</strong> (height above sea level). Put it on H3 and every hexagon becomes a simple
          answer to: how high (or low) is this spot relative to NAP?
        </p>

        <p>
          It also explains why the Dutch cliché <em>"God created the world, but the Dutch created the Netherlands"</em>
          sticks around. A lot of the country is below sea level — yet we live, build, and cycle there because we’ve
          engineered it that way.
        </p>

        <p>
          An interactive map (or a short flyover) makes that feel obvious in seconds:
        </p>

        <div class="iframe-wrapper">
          <iframe
            src="https://maps.mapsthatmatter.io/groundheight"
            height="800"
            loading="lazy"
            title="Groundheight map"
          ></iframe>
        </div>

        <p>
          This is the first step of spatial literacy: make the numbers feel like a place.
        </p>
      </section>

      <section>
        <h2 id="time-travel">Step 2 – When one layer isn't enough: travelling through time</h2>

        <p>
          A single snapshot rarely explains change. The nice part of an H3 datacube is that the grid stays the same
          while the years move — which makes change feel a bit like time travel.
        </p>

        <h3>A quick detour: landcover vs. people</h3>

        <p>
          While poking around the datacube, I ran a simple correlation check between landcover (LGN) and a few
          demographic indicators (CBS). The positive hits were exactly what you’d expect: more built-up area tends to go
          together with more people and more homes:
        </p>

        <ul>
          <li>Total inhabitants (r = 0.79)</li>
          <li>Men and women (r = 0.79)</li>
          <li>Households (r = 0.78)</li>
          <li>Housing units (r = 0.78)</li>
        </ul>

        <p>
          In other words: where you build more, more people live. No plot twist there.
        </p>

        <p>
          The negative correlations were where it got more entertaining.
        </p>

        <p>
          The strongest negative relationships show up between <strong>agrarisch grasland</strong> (agricultural
          grassland) and population density:
        </p>

        <ul>
          <li>Women: r = –0.43</li>
          <li>Total inhabitants: r = –0.43</li>
          <li>Men: r = –0.42</li>
          <li>Households: r = –0.40</li>
        </ul>

        <p>
          Translation: the more grassland a hexagon contains, the fewer people live there — and, very slightly,
          the effect is stronger for women than men.
        </p>

        <p>
          Perfectly logical spatially… and also a very tidy, data-driven explanation for
          <em>"Boer zoekt Vrouw"</em> ("Farmer seeks a wife").
        </p>

        <p>
          According to the hexagons, farmers quite literally live in places with statistically fewer women.
          Pearson’s r has jokes, apparently.
        </p>

        <h3>Time travel on the Maasvlakte</h3>

        <p>
          The next example shows why this becomes useful. Built-up area is rendered in 3D height, colour shows the
          number of inhabitants. Slide through the years and you can watch neighbourhoods grow, densify, or change
          character.
        </p>

        <p>
          A nice “wait, what?” moment shows up on the <strong>Maasvlakte in Rotterdam</strong>. Jump to <strong>2022</strong>
          and you’ll see tall blocks of built-up area — but the hexagons stay dark, meaning zero inhabitants. Not a bug:
          that’s industrial development on newly created land, not housing. The map makes that transformation obvious.
        </p>

        <p>
          That’s the real power here: not just where things are, but <em>when</em> they appeared.
        </p>

        <div class="iframe-wrapper">
          <iframe
            src="https://maps.mapsthatmatter.io/population-3d"
            height="800"
            loading="lazy"
            title="Population 3D map"
          ></iframe>
        </div>
      </section>

      <section>
        <h2 id="talking">Step 3 – Talking to your data</h2>

        <p>
          Once the metadata is clean and structured (JSON helps here), something interesting happens:
          you can start treating the datacube like a thing you can talk to.
        </p>

        <p>
          Say you’re looking for a house in South Holland, and you care about a few practical constraints:
        </p>

        <ul>
          <li>At least 0.3 m above NAP — wet shoes are fine, regular flooding is not.</li>
          <li>Not new-build only; show me places where living is already an existing function.</li>
          <li>Quiet-ish: below a certain background noise level.</li>
          <li>Not near a toxic gas cloud attention area (so not right next to heavy industry).</li>
        </ul>

        <p>You can express that as normal questions:</p>

        <ol>
          <li><em>Where is the terrain higher than 30 centimeters above sea level (NAP)?</em></li>
          <li><em>Where is there already an existing residential function?</em></li>
          <li><em>Where is it relatively quiet, with noise below 50 dB (Lden)?</em></li>
          <li><em>Where is it outside a toxic cloud attention area?</em></li>
        </ol>

        <p>
          An LLM can map those questions to the right fields and turn them into a query on the H3 datacube. No SQL,
          no hunting through column names — just a conversation, with the result showing up on the map.
        </p>

        <div class="video-wrapper">
          <video
            src="videos/llm_example_housing.mp4"
            controls
            autoplay
            muted
            loop
          ></video>
        </div>

        <p>
          The video is from a tool we built at the Province of South Holland: prompt on one side, map on the other.
          It works because the data is described clearly enough for humans and machines to mean the same thing.
        </p>

        <p>
          And because the cube spans multiple years, you can ask time-based questions too. Suddenly, a trend analysis
          becomes a sentence.
        </p>

        <p>
          For example: <em>"Where did inhabitants decrease while forest area increased between 2018 and 2023?"</em>
          The answer shows up as a map — and you can treat it like a new “quiet + green” criterion if you’re house-hunting.
        </p>

        <div class="image-wrapper">
          <img
            src="images/inhabitants_vs_forest_2018_2023.png"
            alt="Inhabitants vs Forest correlation between 2018–2023"
          />
        </div>

        <p>
          If you’re trying to optimize for calm, it’s a useful signal: fewer people, more forest, more breathing room.
        </p>
      </section>

      <section>
        <h2 id="predictions">Step 4 – From patterns to predictions</h2>

        <p>
          With 2018–2023 in one place, each hexagon holds a small timeline. Plot something like average WOZ value or
          new housing units and you start seeing trajectories: areas densifying, areas stabilizing, and areas shifting
          quietly in the background.
        </p>

        <p>
          Even basic trend lines help you anticipate where pressure, growth, or risk could increase if the pattern keeps
          going. It’s not a crystal ball — but it’s a solid head start.
        </p>

        <p>
          Once you can <em>see</em> trajectories, the conversation changes from “what happened?” to “what should we prepare for?”
        </p>
      </section>

      <section>
        <h2 id="explore">Step 5 – Play, explore, decide</h2>

        <p>
          You don’t need specialist software to explore this. A good interactive dashboard runs straight in the browser.
        </p>

        <p>
          In workshops, even non-technical teams start asking better questions almost immediately. Someone points at the map
          and goes: <em>"Ah. So that’s why those two areas feel so different."</em>
        </p>

        <p>
          That’s the goal: spatial data that’s intuitive enough to explore. Sliders for year, WOZ value, noise level —
          suddenly managers and policymakers are testing ideas instead of reading tables.
        </p>

        <p>
          Embed that in a blog post and readers can hover over their own neighbourhood and find the hexagons that surprise them.
        </p>
      </section>

      <section>
        <h2 id="looking-ahead">Step 6 – Looking ahead</h2>

        <p>
          This is still the early version. Next up: connecting the same H3 grid to real-time streams — satellite imagery,
          sensor feeds, weather, biodiversity, the whole lot.
        </p>

        <p>
          When datasets share one spatial language, collaboration gets easier. Maps stop being static reports and start
          acting like shared interfaces for decisions.
        </p>
      </section>

      <section>
        <h2 id="final">Final thought: the power of pattern recognition</h2>

        <p>
          Each hexagon is a data point. Together, they tell stories about how we live, build, and adapt.
        </p>

        <p>
          H3 isn’t just about precision — it’s about a shared perspective. It lets managers, designers, citizens, and data folks
          look at the same landscape through the same lens.
        </p>

        <p>
          From data to dialogue. From hexagons to foresight. From maps that describe the world to maps that help shape it.
        </p>
      </section>

      <section>
        <h2 id="try">Try it yourself</h2>

        <p>
          If you want to play with it: the first version of the datacube (land-cover, demographics, climate, plus municipality
          names from 2018–2023)
          <a href="https://github.com/thijsradijs-pzh/maps-that-matter-kepler/blob/main/data/volledige_tijdreeks_met_namen.parquet">
            is available here as a Parquet file
          </a>.
          Download it and upload it to
          <a href="https://kepler-preview.foursquare.com/" target="_blank" rel="noopener">Kepler (with DuckDB)</a>.
          If you spot interesting patterns, I’d genuinely love to hear what you find — and what you’d use it for.
        </p>
      </section>

      <!-- Mobile Social Share -->
      <div class="mobile-share">
        <div class="mobile-share-title">Share this article</div>
        <div class="mobile-share-buttons">
          <a href="#" class="share-button" id="shareTwitterMobile" title="Share on X" aria-label="Share on X">
            <svg fill="currentColor" viewBox="0 0 24 24">
              <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
          </a>
          <a href="#" class="share-button" id="shareLinkedInMobile" title="Share on LinkedIn" aria-label="Share on LinkedIn">
            <svg fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
          <a href="#" class="share-button" id="shareEmailMobile" title="Share via email" aria-label="Share via email">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
          </a>
          <a href="#" class="share-button" id="copyLinkMobile" title="Copy link" aria-label="Copy link">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
          </a>
        </div>
      </div>
    </main>
  </div>

  <script>
    // ---------- Plausible helpers & scroll depth state ----------
    const scrollMilestones = { 25: false, 50: false, 75: false, 100: false };
    let readCompleteSent = false;

    function track(eventName, props) {
      if (window.plausible) window.plausible(eventName, { props: props || {} });
    }

    // Reading Progress Bar + Scroll Depth
    function updateProgressBar() {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;

      document.getElementById("progressBar").style.width = scrolled + "%";

      // Scroll depth milestones: 25%, 50%, 75%, 100%
      [25, 50, 75, 100].forEach((m) => {
        if (!scrollMilestones[m] && scrolled >= m) {
          scrollMilestones[m] = true;
          track("scroll_depth", { percent: m });
        }
      });

      // Treat 95%+ as "read"
      if (!readCompleteSent && scrolled >= 95) {
        readCompleteSent = true;
        track("article_read_complete");
      }
    }

    window.addEventListener("scroll", updateProgressBar);

    // Approx read time based on word count
    function calculateReadTime() {
      const text = document.querySelector(".page").innerText;
      const wordCount = text.trim().split(/\s+/).length;
      const wordsPerMinute = 200;
      const readTime = Math.ceil(wordCount / wordsPerMinute);
      document.getElementById("readTime").textContent = readTime + " min read";
    }

    calculateReadTime();

    // Highlight active section in TOC
    const sections = document.querySelectorAll("h2[id]");
    const tocLinks = document.querySelectorAll(".toc-list a");

    function highlightTOC() {
      let current = "";

      sections.forEach((section) => {
        const sectionTop = section.offsetTop;
        const scrollPos = window.scrollY + 100;
        if (scrollPos >= sectionTop) current = section.getAttribute("id");
      });

      tocLinks.forEach((link) => {
        link.classList.remove("active");
        if (link.getAttribute("href") === "#" + current) link.classList.add("active");
      });
    }

    window.addEventListener("scroll", highlightTOC);
    highlightTOC();

    // Social Sharing
    const currentUrl = encodeURIComponent(window.location.href);
    const title = encodeURIComponent(document.title);

    function setupShareButtons(prefix = "") {
      // X
      document.getElementById("shareTwitter" + prefix).addEventListener("click", (e) => {
        e.preventDefault();
        window.open(
          `https://twitter.com/intent/tweet?url=${currentUrl}&text=${title}`,
          "_blank",
          "width=550,height=420"
        );
      });

      // LinkedIn
      document.getElementById("shareLinkedIn" + prefix).addEventListener("click", (e) => {
        e.preventDefault();
        window.open(
          `https://www.linkedin.com/sharing/share-offsite/?url=${currentUrl}`,
          "_blank",
          "width=550,height=420"
        );
      });

      // Email
      document.getElementById("shareEmail" + prefix).addEventListener("click", (e) => {
        e.preventDefault();
        window.location.href = `mailto:?subject=${title}&body=Check out this article: ${currentUrl}`;
      });

      // Copy Link
      document.getElementById("copyLink" + prefix).addEventListener("click", (e) => {
        e.preventDefault();
        navigator.clipboard.writeText(window.location.href).then(() => {
          const button = e.currentTarget;
          const originalTitle = button.title;

          button.title = "Copied!";
          button.style.background = "#4CAF50";
          button.style.color = "white";

          setTimeout(() => {
            button.title = originalTitle;
            button.style.background = "";
            button.style.color = "";
          }, 2000);
        });
      });
    }

    setupShareButtons("");
    setupShareButtons("Mobile");
  </script>
</body>
</html>
